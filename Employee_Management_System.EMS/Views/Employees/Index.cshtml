@model EmployeeListVm
@{
	ViewData["Title"] = "Employees";
	int totalPages = (int)Math.Ceiling((double)Model.TotalCount / Model.PageSize);
}

<h2>Employees</h2>

<form method="get" class="row g-2 mb-3">
	<div class="col-md-3">
		<input class="form-control" name="search" value="@Model.Search" placeholder="Search name or email" />
	</div>
	<div class="col-md-3">
		@Html.DropDownList("departmentId", Model.Departments!, "All Departments", new { @class = "form-select", @value = Model.DepartmentId })
	</div>
	<div class="col-md-3">
		@Html.DropDownList("jobTitleId", Model.JobTitles!, "All Job Titles", new { @class = "form-select", @value = Model.JobTitleId })
	</div>
	<div class="col-md-2">
		<select name="pageSize" class="form-select" onchange="this.form.submit()">
			@foreach (var size in new[] { 10, 20, 50 })
			{
				<option value="@size" selected="@(size == Model.PageSize)">@size</option>
			}
		</select>
	</div>
	<div class="col-md-1">
		<button class="btn btn-primary w-100" type="submit">Apply</button>
	</div>
</form>

<p>
	<a class="btn btn-success" asp-action="Create">Add Employee</a>
</p>

<table class="table table-striped">
	<thead>
		<tr>
			<th>Image</th>
			<th>Name</th>
			<th>Email</th>
			<th>Department</th>
			<th>Job Title</th>
			<th>Hire Date</th>
			<th>Salary</th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		@foreach (var e in Model.Items)
		{
			<tr>
				<td>
					@if (!string.IsNullOrEmpty(e.ProfileImagePath))
					{
						<img src="@e.ProfileImagePath" alt="img" width="48" height="48" class="rounded-circle" />
					}
				</td>
				<td>@e.FullName</td>
				<td>@e.Email</td>
				<td>@e.department?.Name</td>
				<td>@e.job?.Title</td>
				<td>@e.HireDate.ToString("yyyy-MM-dd")</td>
				<td>@e.Salary.ToString("C")</td>
				<td class="text-end">
					<a class="btn btn-sm btn-secondary" asp-action="Details" asp-route-id="@e.Id">Details</a>
					<a class="btn btn-sm btn-primary" asp-action="Edit" asp-route-id="@e.Id">Edit</a>
					<a class="btn btn-sm btn-danger" asp-action="Delete" asp-route-id="@e.Id">Delete</a>
				</td>
			</tr>
		}
	</tbody>
</table>

@if (totalPages > 1)
{
	<nav>
		<ul class="pagination">
			@for (int i = 1; i <= totalPages; i++)
			{
				<li class="page-item @(i == Model.Page ? "active" : "")">
					<a class="page-link"
					   asp-action="Index"
					   asp-route-search="@Model.Search"
					   asp-route-departmentId="@Model.DepartmentId"
					   asp-route-jobTitleId="@Model.JobTitleId"
					   asp-route-page="@i"
					   asp-route-pageSize="@Model.PageSize">@i</a>
				</li>
			}
		</ul>
	</nav>
}
